<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<!-- FontAwesome Icons -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
<!-- Alertify CSS -->
<link href="https://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/alertify.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/default.min.css" rel="stylesheet" />
<!-- Custom Barbershop CSS -->
<link href="~/css/customed.css" rel="stylesheet" />
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Alertify JS -->
<script src="https://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/alertify.min.js"></script>

@using BookingSystem.Models
@using System
@model List<EmployeeModel>
@{
    ViewData["Title"] = "Pengurusan Kakitangan - Amm Barbershop";
}

<!-- Theme Switcher -->
<div class="theme-switcher">
    <div class="theme-option theme-bg-1 active" data-theme="theme-bg-1" style="background: linear-gradient(45deg, #667eea, #764ba2);" title="Barbershop - Blue Theme"></div>
    <div class="theme-option theme-bg-2" data-theme="theme-bg-2" style="background: linear-gradient(45deg, #56ab2f, #a8e6cf);" title="Barbershop - Green Theme"></div>
    <div class="theme-option theme-bg-3" data-theme="theme-bg-3" style="background: linear-gradient(45deg, #ff9a9e, #fecfef);" title="Barbershop - Pink Theme"></div>
    <div class="theme-option theme-bg-4" data-theme="theme-bg-4" style="background: linear-gradient(45deg, #4facfe, #00f2fe);" title="Barbershop - Cyan Theme"></div>
                </div>

<div class="barbershop-container fade-in" style="height: 80vh; overflow-y: auto;">

    <!-- Barbershop Header -->
    <div class="barbershop-header">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <div class="d-flex align-items-center mb-2">
                    <a href="/" class="btn btn-sm btn-outline-light me-3">
                        <i class="fas fa-home me-1"></i>Utama
                    </a>
                    <h3 class="mb-0"><i class="fas fa-users me-3"></i>Pengurusan Kakitangan</h3>
                                        </div>
                <div class="subtitle">Urus tukang gunting dan ahli kakitangan anda</div>
                                    </div>
            <div class="d-flex gap-3">
                <button type="button" class="btn btn-barbershop" id="btnCreateNew">
                    <i class="fas fa-user-plus me-2"></i>Tambah Kakitangan
                </button>
                            </div>
                        </div>
                    </div>

    <!-- Main Content Area -->
    <div class="row">
        <div class="col-12">
            <!-- Search and Filter Section -->
            <div class="barbershop-card mb-3">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <div class="search-container">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" id="employeeSearch" class="search-input" placeholder="Cari kakitangan..." />
                            </div>
                                </div>
                        <div class="col-md-6">
                            <div class="d-flex gap-2 justify-content-end">
                                <select id="statusFilter" class="form-select" style="width: auto;">
                                    <option value="">Semua Status</option>
                                    <option value="Aktif">Aktif</option>
                                    <option value="Menunggu">Menunggu</option>
                                    <option value="Tidak Aktif">Tidak Aktif</option>
                                </select>
                                <select id="roleFilter" class="form-select" style="width: auto;">
                                    <option value="">Semua Jawatan</option>
                                    <option value="Tukang Gunting Kanan">Tukang Gunting Kanan</option>
                                    <option value="Tukang Gunting Junior">Tukang Gunting Junior</option>
                                    <option value="Pakar Gaya">Pakar Gaya</option>
                                    <option value="Resepsionis">Resepsionis</option>
                                    <option value="Pengurus">Pengurus</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Staff Management Content -->
            <div class="barbershop-card">
                <div class="card-body p-0">
                    @{
                        await Html.RenderPartialAsync("~/Views/EmployeeSetup/_Lists.cshtml", Model, ViewData);
                    }
                </div>
            </div>
        </div>
    </div>


    <!-- Custom Staff Modal - Simple and Clickable -->
    <div id="staffModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 15px; padding: 0; max-width: 90%; max-height: 90%; width: 800px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); position: relative;">
            <!-- Header -->
            <div style="background: #f8f9fa; padding: 20px; border-radius: 15px 15px 0 0; border-bottom: 1px solid #dee2e6;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h5 style="margin: 0; color: #333;">
                        <i class="fas fa-user-plus me-2"></i>Tambah Ahli Kakitangan Baru
                    </h5>
                    <button type="button" id="closeModalBtn" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">&times;</button>
                </div>
            </div>
            
            <!-- Body -->
            <div style="padding: 30px; max-height: 60vh; overflow-y: auto;">
                <form id="staffForm">
                    <input type="hidden" id="staffId" name="Id" value="0">
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <label for="staffName" style="display: block; margin-bottom: 5px; font-weight: 500;">Nama Penuh *</label>
                            <input type="text" id="staffName" name="Name" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        </div>
                        <div>
                            <label for="staffRole" style="display: block; margin-bottom: 5px; font-weight: 500;">Jawatan *</label>
                            <select id="staffRole" name="Role" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                                <option value="">Pilih Jawatan</option>
                                <option value="Tukang Gunting Kanan">Tukang Gunting Kanan</option>
                                <option value="Tukang Gunting Junior">Tukang Gunting Junior</option>
                                <option value="Pakar Gaya">Pakar Gaya</option>
                                <option value="Resepsionis">Resepsionis</option>
                                <option value="Pengurus">Pengurus</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <label for="staffPhone" style="display: block; margin-bottom: 5px; font-weight: 500;">Nombor Telefon *</label>
                            <input type="tel" id="staffPhone" name="Phone" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        </div>
                        <div>
                            <label for="staffEmail" style="display: block; margin-bottom: 5px; font-weight: 500;">Alamat E-mel *</label>
                            <input type="email" id="staffEmail" name="Email" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <label for="staffSpecialty" style="display: block; margin-bottom: 5px; font-weight: 500;">Kepakaran</label>
                            <input type="text" id="staffSpecialty" name="Specialty" placeholder="cth., Potongan Klasik, Janggut" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        </div>
                        <div>
                            <label for="staffExperience" style="display: block; margin-bottom: 5px; font-weight: 500;">Tahun Pengalaman</label>
                            <input type="number" id="staffExperience" name="Experience" min="0" max="50" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <label for="staffStatus" style="display: block; margin-bottom: 5px; font-weight: 500;">Status *</label>
                            <select id="staffStatus" name="Status" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                                <option value="Aktif">Aktif</option>
                                <option value="Menunggu">Menunggu</option>
                                <option value="Tidak Aktif">Tidak Aktif</option>
                            </select>
                        </div>
                        <div>
                            <label for="staffStartDate" style="display: block; margin-bottom: 5px; font-weight: 500;">Tarikh Mula</label>
                            <input type="date" id="staffStartDate" name="StartDate" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label for="staffImage" style="display: block; margin-bottom: 5px; font-weight: 500;">Gambar Profil</label>
                        <input type="file" id="staffImage" name="ImageUrl" accept="image/*" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        <small style="color: #666; font-size: 12px;">Format yang disokong: JPG, PNG, GIF (Maksimum 5MB)</small>
                        <div id="currentImagePreview"></div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label for="staffNotes" style="display: block; margin-bottom: 5px; font-weight: 500;">Nota Tambahan</label>
                        <textarea id="staffNotes" name="Notes" rows="3" placeholder="Sebarang maklumat tambahan tentang ahli kakitangan..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; resize: vertical;"></textarea>
                    </div>
                </form>
            </div>
            
            <!-- Footer -->
            <div style="background: #f8f9fa; padding: 20px; border-radius: 0 0 15px 15px; border-top: 1px solid #dee2e6; display: flex; gap: 10px; justify-content: flex-end;">
                <button type="button" id="cancelBtn" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                    <i class="fas fa-times me-2"></i>Batal
                </button>
                <button type="button" id="saveStaffBtn" style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                    <i class="fas fa-save me-2"></i>Simpan Kakitangan
                </button>
            </div>
        </div>
    </div>

    <!-- Image Preview Modal -->
    <div id="imagePreviewModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 10px; padding: 20px; max-width: 90%; max-height: 90%; text-align: center; position: relative; margin: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h5 style="margin: 0;">Gambar Profil Kakitangan</h5>
                <button type="button" id="closeImageModal" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
            </div>
            <img id="previewImage" src="" alt="Employee Image" style="max-width: 100%; max-height: 70vh; border-radius: 8px;">
        </div>
    </div>

</div>

<script type="text/javascript">
    (function() {
        // Ensure jQuery is loaded before proceeding
        if (typeof $ === 'undefined') {
            console.error('jQuery is not loaded!');
            alert('jQuery failed to load. Please refresh the page.');
            return;
        }
        
    $(document).ready(function() {
        console.log('Document ready - initializing...'); // Debug log
        
        // Initialize DataTable
        if ($.fn.DataTable) {
            $('#employeeTable').DataTable({
                responsive: true,
                pageLength: 10,
                language: {
                    search: "Search staff:",
                    lengthMenu: "Show _MENU_ staff per page",
                    info: "Showing _START_ to _END_ of _TOTAL_ staff",
                    paginate: {
                        first: "First",
                        last: "Last",
                        next: "Next",
                        previous: "Previous"
                    }
                }
            });
        }

        // Theme Switcher Functionality
        $('.theme-option').click(function() {
            // Remove active class from all options
            $('.theme-option').removeClass('active');
            
            // Add active class to clicked option
            $(this).addClass('active');
            
            // Get the theme class
            var themeClass = $(this).data('theme');
            
            // Apply theme to body
            $('body').removeClass('theme-bg-1 theme-bg-2 theme-bg-3 theme-bg-4');
            $('body').addClass(themeClass);
            
            // Store theme preference in localStorage
            localStorage.setItem('barbershop-theme', themeClass);
        });

        // Load saved theme on page load
        var savedTheme = localStorage.getItem('barbershop-theme');
        if (savedTheme) {
            $('body').addClass(savedTheme);
            $('.theme-option').removeClass('active');
            $('.theme-option[data-theme="' + savedTheme + '"]').addClass('active');
        }

        // Add smooth animations
        $('.barbershop-container').addClass('fade-in');
        
        // Button click animations
        $('.btn-barbershop, .btn-barbershop-secondary').click(function() {
            $(this).addClass('pulse');
            setTimeout(() => {
                $(this).removeClass('pulse');
            }, 200);
        });
        

        // Load employees on page load
        loadEmployees();

        // Add Staff Button - Simple Custom Modal
        $('#btnCreateNew').click(function() {
            console.log('Add staff button clicked');
            
            // First prompt for master password
            alertify.prompt('Kata Laluan Master', 'Masukkan kata laluan master untuk menambah kakitangan:', '', 
                function(evt, value) {
                    if (value === 'admin123') {
                        // Password correct, proceed with add
                        $('#staffForm')[0].reset();
                        $('#staffId').val('0');
                        
                        // Clear image preview
                        $('#currentImagePreview').html('');
                        
                        // Show custom modal
                        $('#staffModal').css('display', 'flex');
                        console.log('Custom modal shown');
                    } else {
                        alertify.error('Kata laluan master tidak betul!');
                    }
                },
                function(evt) {
                    // User cancelled password prompt
                    alertify.message('Operasi dibatalkan');
                }
            ).set('type', 'password');
        });

        // Edit Staff Button - Use event delegation for dynamically created buttons
        $(document).on('click', '.edit-employee-btn', function() {
            var employeeId = $(this).data('employee-id');
            console.log('Edit staff clicked for ID:', employeeId);
            
            // First prompt for master password
            alertify.prompt('Kata Laluan Master', 'Masukkan kata laluan master untuk mengedit kakitangan:', '', 
                function(evt, value) {
                    if (value === 'admin123') {
                        // Password correct, proceed with edit
                        // Fetch employee data from server
                        $.ajax({
                            url: '/EmployeeSetup/GetEmployees',
                            type: 'GET',
                            success: function(response) {
                                if (response.success) {
                                    var employee = response.employees.find(e => e.id === employeeId);
                                    if (employee) {
                                        // Populate the form
                                        $('#staffId').val(employee.id);
                                        $('#staffName').val(employee.name);
                                        $('#staffRole').val(employee.role);
                                        $('#staffPhone').val(employee.phone);
                                        $('#staffEmail').val(employee.email);
                                        $('#staffSpecialty').val(employee.specialty || '');
                                        $('#staffExperience').val(employee.experience || 0);
                                        $('#staffStatus').val(employee.status);
                                        $('#staffStartDate').val(employee.startDate ? employee.startDate.split('T')[0] : '');
                                        $('#staffNotes').val(employee.notes || '');
                                        
                                        // Handle image display for edit
                                        if (employee.imageUrl && employee.imageUrl !== '') {
                                            $('#currentImagePreview').html('<img src="' + employee.imageUrl + '" alt="Current Image" style="max-width: 100px; max-height: 100px; border-radius: 8px; margin-top: 10px;">');
                                        } else {
                                            $('#currentImagePreview').html('<p class="text-muted mt-2">Tiada gambar</p>');
                                        }
                                        
                                        // Change modal title and button
                                        $('#staffModalLabel').html('<i class="fas fa-edit me-2"></i>Edit Ahli Kakitangan');
                                        
                                        // Clear any previous form state
                                        $('#staffForm')[0].reset();
                                        
                                        // Re-populate form after reset
                                        $('#staffId').val(employee.id);
                                        $('#staffName').val(employee.name);
                                        $('#staffRole').val(employee.role);
                                        $('#staffPhone').val(employee.phone);
                                        $('#staffEmail').val(employee.email);
                                        $('#staffSpecialty').val(employee.specialty || '');
                                        $('#staffExperience').val(employee.experience || 0);
                                        $('#staffStatus').val(employee.status);
                                        $('#staffStartDate').val(employee.startDate ? employee.startDate.split('T')[0] : '');
                                        $('#staffNotes').val(employee.notes || '');
                                        
                                        // Show modal
                                        $('#staffModal').css('display', 'flex');
                                    }
                                }
                            },
                            error: function(xhr, status, error) {
                                console.error('Error fetching employee data:', error);
                                alertify.error('Ralat memuatkan data kakitangan');
                            }
                        });
                    } else {
                        alertify.error('Kata laluan master tidak betul!');
                    }
                },
                function(evt) {
                    // User cancelled password prompt
                    alertify.message('Operasi dibatalkan');
                }
            ).set('type', 'password');
        });

        // Delete Staff Button - Use event delegation for dynamically created buttons
        $(document).on('click', '.delete-employee-btn', function() {
            var employeeId = $(this).data('employee-id');
            var employeeName = $(this).data('employee-name');
            console.log('Delete staff clicked for ID:', employeeId);
            
            // First prompt for master password
            alertify.prompt('Kata Laluan Master', 'Masukkan kata laluan master untuk memadam kakitangan:', '', 
                function(evt, value) {
                    if (value === 'admin123') {
                        // Password correct, now show delete confirmation
                        alertify.confirm('Padam Kakitangan', 
                            'Adakah anda pasti mahu memadam kakitangan "' + employeeName + '"? Tindakan ini tidak boleh dibatalkan.',
                            function() {
                                // Delete employee via AJAX
                                $.ajax({
                                    url: '/EmployeeSetup/Delete',
                                    type: 'POST',
                                    contentType: 'application/json',
                                    data: JSON.stringify(employeeId),
                                    success: function(response) {
                                        if (response.success) {
                                            alertify.success(response.message);
                                            loadEmployees(); // Reload the employees list
                                        } else {
                                            alertify.error(response.message);
                                        }
                                    },
                                    error: function(xhr, status, error) {
                                        console.error('Error deleting employee:', error);
                                        alertify.error('Ralat berlaku semasa memadam kakitangan');
                                    }
                                });
                            },
                            function() {
                                alertify.message('Padam dibatalkan');
                            }
                        );
                    } else {
                        alertify.error('Kata laluan master tidak betul!');
                    }
                },
                function(evt) {
                    // User cancelled password prompt
                    alertify.message('Operasi dibatalkan');
                }
            ).set('type', 'password');
        });

        // Save Staff Button - Following Service Setup Pattern
        $('#saveStaffBtn').click(function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('Save staff button clicked - Event:', e);
            console.log('Button element:', this);
            
            if (validateStaffForm()) {
                // Prompt for master password
                alertify.prompt('Kata Laluan Master', 'Masukkan kata laluan master untuk menambah/mengemas kini kakitangan:', '', 
                    function(evt, value) {
                        if (value === 'admin123') {
                            // Password correct, proceed with save
                            var isEdit = $('#staffId').val() && $('#staffId').val() !== '0';
                            var url = isEdit ? '/EmployeeSetup/Update' : '/EmployeeSetup/Create';
                            
                            // Create FormData for file upload
                            var formData = new FormData();
                            formData.append('Id', $('#staffId').val());
                            formData.append('Name', $('#staffName').val());
                            formData.append('Role', $('#staffRole').val());
                            formData.append('Phone', $('#staffPhone').val());
                            formData.append('Email', $('#staffEmail').val());
                            formData.append('Specialty', $('#staffSpecialty').val());
                            formData.append('Experience', $('#staffExperience').val());
                            formData.append('Status', $('#staffStatus').val());
                            formData.append('StartDate', $('#staffStartDate').val());
                            formData.append('Notes', $('#staffNotes').val());
                            
                            // Add image file if selected
                            var imageFile = $('#staffImage')[0].files[0];
                            if (imageFile) {
                                formData.append('imageFile', imageFile);
                            }
                            
                            console.log('Staff data being sent:', Object.fromEntries(formData));
                            
                            $.ajax({
                                url: url,
                                type: 'POST',
                                data: formData,
                                processData: false,
                                contentType: false,
                                success: function(response) {
                                    console.log('Staff saved successfully:', response);
                                    if (response.success) {
                                        alertify.success(isEdit ? 'Kakitangan berjaya dikemas kini!' : 'Kakitangan berjaya ditambah!');
                                        closeModal();
                                        // Refresh the employees list
                                        loadEmployees();
                                    } else {
                                        alertify.error(response.message || 'Ralat berlaku semasa menyimpan kakitangan.');
                                    }
                                },
                                error: function(xhr, status, error) {
                                    console.error('Staff save failed:', error);
                                    alertify.error('Ralat berlaku semasa menghantar permintaan. Sila cuba lagi.');
                                }
                            });
                        } else {
                            alertify.error('Kata laluan master tidak betul!');
                        }
                    },
                    function(evt) {
                        // User cancelled
                        alertify.message('Operasi dibatalkan');
                    }
                ).set('type', 'password');
            }
        });

        // Form validation - Following Service Setup Pattern
        function validateStaffForm() {
            var isValid = true;
            var requiredFields = ['staffName', 'staffRole', 'staffPhone', 'staffEmail', 'staffStatus'];
            
            requiredFields.forEach(function(fieldId) {
                var field = $('#' + fieldId);
                if (!field.val().trim()) {
                    field.addClass('is-invalid');
                    isValid = false;
                } else {
                    field.removeClass('is-invalid');
                }
            });

            // Validate email format
            var email = $('#staffEmail').val();
            var emailRegex = /^[^\s@@]+@@[^\s@@]+\.[^\s@@]+$/;
            if (email && !emailRegex.test(email)) {
                $('#staffEmail').addClass('is-invalid');
                isValid = false;
            }

            if (!isValid) {
                alertify.error('Sila isi semua medan yang diperlukan dengan betul.');
            }

            return isValid;
        }

        // Remove validation classes on input
        $('input, select, textarea').on('input change', function() {
            $(this).removeClass('is-invalid');
        });

        // Search functionality
        $('#employeeSearch').on('keyup', function() {
            var searchTerm = $(this).val().toLowerCase();
            filterEmployees();
        });

        // Filter functionality
        $('#statusFilter, #roleFilter').on('change', function() {
            filterEmployees();
        });

        // Image preview functionality
        $('#closeImageModal').click(function() {
            $('#imagePreviewModal').hide();
        });

        // Close image modal when clicking outside
        $('#imagePreviewModal').click(function(e) {
            if (e.target === this) {
                $('#imagePreviewModal').hide();
            }
        });

        // View employee image functionality
        $(document).on('click', '.view-employee-image', function() {
            var imageSrc = $(this).data('image-src');
            if (imageSrc && imageSrc !== '') {
                $('#previewImage').attr('src', imageSrc);
                $('#imagePreviewModal').show();
            } else {
                alertify.warning('Tiada gambar profil untuk kakitangan ini.');
            }
        });

        // Close button handlers
        $('#closeModalBtn').click(function() {
            console.log('Close button (X) clicked');
            closeModal();
        });

        $('#cancelBtn').click(function() {
            console.log('Cancel button clicked');
            closeModal();
        });

        // Function to close modal properly
        function closeModal() {
            $('#staffModal').css('display', 'none');
            $('#staffForm')[0].reset();
            $('#currentImagePreview').html('');
            console.log('Modal closed');
        }

        // Close modal when clicking outside content
        $('#staffModal').click(function(e) {
            if (e.target === this) {
                console.log('Clicked outside modal content - closing modal');
                closeModal();
            }
        });

        // Prevent modal content clicks from closing modal
        $('#staffModal > div').click(function(e) {
            e.stopPropagation();
        });
    });

    // Add pulse animation class and modal fixes
    $('<style>')
        .prop('type', 'text/css')
        .html(`
            .pulse {
                animation: pulse 0.2s ease-in-out;
            }
            @@keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.05); }
                100% { transform: scale(1); }
            }
            
            /* Modal fixes - Enhanced for clickability */
            .modal {
                z-index: 9999 !important;
            }
            .modal-backdrop {
                z-index: 9998 !important;
            }
            .modal-dialog {
                z-index: 10000 !important;
                pointer-events: auto !important;
            }
            .modal-content {
                border: none;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 10001 !important;
                pointer-events: auto !important;
                position: relative;
            }
            .modal-header, .modal-body, .modal-footer {
                z-index: 10002 !important;
                pointer-events: auto !important;
                position: relative;
            }
            .modal input, .modal select, .modal textarea, .modal button {
                z-index: 10003 !important;
                pointer-events: auto !important;
                position: relative;
            }
            .modal.show {
                display: block !important;
                pointer-events: auto !important;
            }
            
            /* Search and Filter Styles */
            .search-container {
                position: relative;
                display: inline-block;
                width: 100%;
            }
            
            .search-icon {
                position: absolute;
                left: 12px;
                top: 50%;
                transform: translateY(-50%);
                color: #6c757d;
                z-index: 10;
            }
            
            .search-input {
                width: 100%;
                padding: 10px 10px 10px 40px;
                border: 1px solid #ddd;
                border-radius: 8px;
                font-size: 14px;
            }
            
            .search-input:focus {
                outline: none;
                border-color: var(--barbershop-primary);
                box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.25);
            }
            
            /* Employee Photo Styles */
            .employee-photo {
                transition: transform 0.2s ease;
                border: 2px solid #e9ecef;
            }
            
            .employee-photo:hover {
                transform: scale(1.1);
                border-color: var(--barbershop-primary);
            }
            
            /* Action Button Styles */
            .action-btn {
                display: inline-flex;
                align-items: center;
                justify-content: center;
                width: 32px;
                height: 32px;
                border: none;
                border-radius: 6px;
                margin: 0 2px;
                cursor: pointer;
                transition: all 0.2s ease;
                font-size: 12px;
            }
            
            .action-btn-view {
                background: #17a2b8;
                color: white;
            }
            
            .action-btn-edit {
                background: #ffc107;
                color: #212529;
            }
            
            .action-btn-delete {
                background: #dc3545;
                color: white;
            }
            
            .action-btn:hover {
                transform: translateY(-1px);
                box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            }
            
            
        `)
        .appendTo('head');
    })(); // End of immediately invoked function

    // Function to load employees from database
    function loadEmployees() {
        $.ajax({
            url: '/EmployeeSetup/GetEmployees',
            type: 'GET',
            success: function(response) {
                if (response.success) {
                    updateEmployeeTable(response.employees);
                }
            },
            error: function(xhr, status, error) {
                console.error('Error loading employees:', error);
                $('#employeeTableBody').html('<tr><td colspan="8" class="text-center py-4"><i class="fas fa-exclamation-triangle fa-2x mb-3"></i><p class="text-muted">Ralat memuatkan senarai kakitangan</p></td></tr>');
            }
        });
    }

    // Function to update the employee table display
    function updateEmployeeTable(employees) {
        var tbody = $('#employeeTableBody');
        
        if (employees.length === 0) {
            tbody.html('<tr><td colspan="8" class="text-center py-4"><i class="fas fa-users fa-2x mb-3"></i><p class="text-muted">Tiada kakitangan ditemui</p></td></tr>');
            return;
        }

        var html = '';
        employees.forEach(function(employee) {
            var statusClass = employee.status === 'Aktif' ? 'status-active' : 
                             employee.status === 'Menunggu' ? 'status-pending' : 'status-inactive';
            
            var avatarClass = employee.status === 'Aktif' ? 'bg-primary' : 
                             employee.status === 'Menunggu' ? 'bg-warning' : 'bg-secondary';
            
            html += '<tr>';
            html += '<td class="text-center">';
            if (employee.imageUrl && employee.imageUrl !== '') {
                html += '<img src="' + employee.imageUrl + '" alt="Employee Photo" class="employee-photo" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover; cursor: pointer;" data-image-src="' + employee.imageUrl + '">';
            } else {
                html += '<div class="avatar-circle ' + avatarClass + ' text-white d-inline-flex align-items-center justify-content-center" style="width: 40px; height: 40px; border-radius: 50%;">';
                html += '<i class="fas fa-user"></i>';
                html += '</div>';
            }
            html += '</td>';
            html += '<td>';
            html += '<div class="fw-bold">' + employee.name + '</div>';
            html += '<small class="text-muted">ID: #' + employee.id.toString().padStart(3, '0') + '</small>';
            html += '</td>';
            html += '<td>';
            html += '<span class="badge bg-primary">' + employee.role + '</span>';
            html += '</td>';
            html += '<td>';
            html += '<div><i class="fas fa-phone me-1"></i>' + (employee.phone || 'N/A') + '</div>';
            html += '<small class="text-muted"><i class="fas fa-envelope me-1"></i>' + (employee.email || 'N/A') + '</small>';
            html += '</td>';
            html += '<td>';
            html += '<span class="badge bg-secondary">' + (employee.specialty || 'General') + '</span>';
            html += '</td>';
            html += '<td>';
            html += '<span class="status-badge ' + statusClass + '">' + employee.status + '</span>';
            html += '</td>';
            html += '<td>';
            html += '<div>' + employee.experience + '+ tahun</div>';
            html += '<small class="text-muted">Sejak ' + (employee.startDate ? new Date(employee.startDate).getFullYear() : new Date().getFullYear()) + '</small>';
            html += '</td>';
            html += '<td class="text-center">';
            if (employee.imageUrl && employee.imageUrl !== '') {
                html += '<button class="action-btn action-btn-view view-employee-image" data-image-src="' + employee.imageUrl + '" title="Lihat Gambar"><i class="fas fa-image"></i></button>';
            }
            html += '<button class="action-btn action-btn-edit edit-employee-btn" data-employee-id="' + employee.id + '" title="Edit Kakitangan"><i class="fas fa-edit"></i></button>';
            html += '<button class="action-btn action-btn-delete delete-employee-btn" data-employee-id="' + employee.id + '" data-employee-name="' + employee.name + '" title="Buang Kakitangan"><i class="fas fa-trash"></i></button>';
            html += '</td>';
            html += '</tr>';
        });

        tbody.html(html);
    }

    // Function to filter employees
    function filterEmployees() {
        var searchTerm = $('#employeeSearch').val().toLowerCase();
        var statusFilter = $('#statusFilter').val();
        var roleFilter = $('#roleFilter').val();
        
        $('#employeeTableBody tr').each(function() {
            var row = $(this);
            var name = row.find('td:eq(1)').text().toLowerCase();
            var role = row.find('td:eq(2)').text();
            var status = row.find('td:eq(5)').text();
            
            var matchesSearch = name.includes(searchTerm);
            var matchesStatus = !statusFilter || status === statusFilter;
            var matchesRole = !roleFilter || role === roleFilter;
            
            if (matchesSearch && matchesStatus && matchesRole) {
                row.show();
            } else {
                row.hide();
            }
        });
    }

</script>
</script>