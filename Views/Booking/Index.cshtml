<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<!-- FontAwesome Icons -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
<!-- Alertify CSS -->
<link href="https://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/alertify.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/default.min.css" rel="stylesheet" />
<!-- Custom Barbershop CSS -->
<link href="~/css/customed.css" rel="stylesheet" />
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Alertify JS -->
<script src="https://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/alertify.min.js"></script>

@model List<BookingSystem.Models.BookingModel>
@{
    ViewData["Title"] = "Tempah Janji Temu - Amm Barbershop";
}

<!-- Theme Switcher -->
<div class="theme-switcher">
    <div class="theme-option theme-bg-1 active" data-theme="theme-bg-1" style="background: linear-gradient(45deg, #667eea, #764ba2);" title="Barbershop - Blue Theme"></div>
    <div class="theme-option theme-bg-2" data-theme="theme-bg-2" style="background: linear-gradient(45deg, #56ab2f, #a8e6cf);" title="Barbershop - Green Theme"></div>
    <div class="theme-option theme-bg-3" data-theme="theme-bg-3" style="background: linear-gradient(45deg, #ff9a9e, #fecfef);" title="Barbershop - Pink Theme"></div>
    <div class="theme-option theme-bg-4" data-theme="theme-bg-4" style="background: linear-gradient(45deg, #4facfe, #00f2fe);" title="Barbershop - Cyan Theme"></div>
</div>

<div class="barbershop-container fade-in">
    <!-- Header -->
    <div class="barbershop-header">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <div class="d-flex align-items-center mb-2">
                    <a href="/" class="btn btn-sm btn-outline-light me-3">
                        <i class="fas fa-home me-1"></i>Utama
                    </a>
                    <h3 class="mb-0"><i class="fas fa-calendar-plus me-3"></i>Tempah Janji Temu</h3>
                </div>
                <div class="subtitle">Jadualkan janji temu barbershop anda</div>
            </div>
        </div>
    </div>

    <!-- Booking Form -->
    <div class="row">
        <div class="col-lg-8">
            <div class="barbershop-card">
                <div class="card-header">
                    <h5><i class="fas fa-calendar-check me-2"></i>Butiran Janji Temu</h5>
                </div>
                <div class="card-body">
                    <form id="bookingForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="customerName" class="form-label fw-bold">Nama Penuh *</label>
                                <input type="text" class="form-control barbershop-search" id="customerName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="customerPhone" class="form-label fw-bold">Nombor Telefon *</label>
                                <input type="tel" class="form-control barbershop-search" id="customerPhone" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="serviceType" class="form-label fw-bold">Perkhidmatan *</label>
                                <select class="form-select barbershop-filter" id="serviceType" required>
                                    <option value="">Pilih Perkhidmatan</option>
                                    <option value="Gunting Rambut">Gunting Rambut - $25</option>
                                    <option value="Potong Janggut">Potong Janggut - $15</option>
                                    <option value="Perkhidmatan Lengkap">Perkhidmatan Lengkap - $35</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="appointmentDate" class="form-label fw-bold">Tarikh *</label>
                                <input type="date" class="form-control barbershop-search" id="appointmentDate" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="appointmentTime" class="form-label fw-bold">Masa *</label>
                                <select class="form-select barbershop-filter" id="appointmentTime" required>
                                    <option value="">Pilih Masa</option>
                                    <option value="10:00">10:00 AM</option>
                                    <option value="11:00">11:00 AM</option>
                                    <option value="12:00">12:00 PM</option>
                                    <option value="13:00">1:00 PM</option>
                                    <option value="14:00">2:00 PM</option>
                                    <option value="15:00">3:00 PM</option>
                                    <option value="16:00">4:00 PM</option>
                                    <option value="17:00">5:00 PM</option>
                                    <option value="18:00">6:00 PM</option>
                                    <option value="19:00">7:00 PM</option>
                                    <option value="20:00">8:00 PM</option>
                                    <option value="21:00">9:00 PM</option>
                                    <option value="22:00">10:00 PM</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="barberSelect" class="form-label fw-bold">Tukang Gunting Pilihan</label>
                                <select class="form-select barbershop-filter" id="barberSelect">
                                    <option value="">Mana-mana Yang Tersedia</option>
                                    <option value="Ali">Ali</option>
                                    <option value="Hassan">Hassan</option>
                                    <option value="Ahmad">Ahmad</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="specialRequests" class="form-label fw-bold">Permintaan Khas</label>
                            <textarea class="form-control barbershop-search" id="specialRequests" rows="3" placeholder="Sebarang permintaan atau nota khusus..."></textarea>
                        </div>
                        <div class="text-end">
                            <button type="button" class="btn btn-barbershop" id="submitBookingBtn">
                                <i class="fas fa-check me-2"></i>Tempah Janji Temu
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Today's Bookings -->
        <div class="col-lg-4">
            <div class="barbershop-card">
                <div class="card-header">
                    <h5><i class="fas fa-calendar-day me-2"></i>Janji Temu Hari Ini</h5>
                </div>
                <div class="card-body">
                    <div id="todayBookingsList">
                        <!-- Bookings will be loaded here via JavaScript -->
                        <div class="text-center text-muted py-4">
                            <i class="fas fa-spinner fa-spin fa-3x mb-3"></i>
                            <p>Memuatkan janji temu...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Appointment Feedback Modal -->
<div id="feedbackModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto;">
        <!-- Modal Header -->
        <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 15px 15px 0 0; display: flex; justify-content: space-between; align-items: center;">
            <h5 style="margin: 0; font-weight: 600;">
                <i class="fas fa-star me-2"></i>Maklum Balas Janji Temu
            </h5>
            <button type="button" id="closeFeedbackModalBtn" style="background: none; border: none; color: white; font-size: 20px; cursor: pointer;">&times;</button>
        </div>
        
        <!-- Modal Body -->
        <div style="padding: 30px;">
            <form id="feedbackForm">
                <input type="hidden" id="feedbackBookingId" />
                
                <!-- Rating Section -->
                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 10px; font-weight: 600; font-size: 16px;">Penilaian Perkhidmatan *</label>
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <input type="radio" id="rating1" name="rating" value="1" style="display: none;">
                        <label for="rating1" class="star-rating" data-rating="1">★</label>
                        <input type="radio" id="rating2" name="rating" value="2" style="display: none;">
                        <label for="rating2" class="star-rating" data-rating="2">★</label>
                        <input type="radio" id="rating3" name="rating" value="3" style="display: none;">
                        <label for="rating3" class="star-rating" data-rating="3">★</label>
                        <input type="radio" id="rating4" name="rating" value="4" style="display: none;">
                        <label for="rating4" class="star-rating" data-rating="4">★</label>
                        <input type="radio" id="rating5" name="rating" value="5" style="display: none;">
                        <label for="rating5" class="star-rating" data-rating="5">★</label>
                    </div>
                    <div id="ratingText" style="text-align: center; margin-top: 10px; color: #6c757d; font-size: 14px;"></div>
                </div>
                
                <!-- Comment Section -->
                <div style="margin-bottom: 25px;">
                    <label for="feedbackComment" style="display: block; margin-bottom: 10px; font-weight: 600; font-size: 16px;">Komen (Pilihan)</label>
                    <textarea id="feedbackComment" rows="4" placeholder="Kongsi pengalaman anda dengan perkhidmatan kami..." style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; resize: vertical; font-family: inherit;"></textarea>
                </div>
                
                <!-- Status Section -->
                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 10px; font-weight: 600; font-size: 16px;">Status Janji Temu *</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                        <label style="display: flex; align-items: center; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; cursor: pointer; transition: all 0.3s ease;">
                            <input type="radio" name="status" value="Finish" style="margin-right: 8px;">
                            <span style="color: #28a745; font-weight: 500;">✓ Selesai</span>
                        </label>
                        <label style="display: flex; align-items: center; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; cursor: pointer; transition: all 0.3s ease;">
                            <input type="radio" name="status" value="Cancel" style="margin-right: 8px;">
                            <span style="color: #dc3545; font-weight: 500;">✗ Batal</span>
                        </label>
                        <label style="display: flex; align-items: center; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; cursor: pointer; transition: all 0.3s ease;">
                            <input type="radio" name="status" value="Pending" style="margin-right: 8px;">
                            <span style="color: #ffc107; font-weight: 500;">⏳ Menunggu</span>
                        </label>
                    </div>
                </div>
            </form>
        </div>
        
        <!-- Modal Footer -->
        <div style="padding: 20px; background: #f8f9fa; border-radius: 0 0 15px 15px; display: flex; justify-content: flex-end; gap: 10px;">
            <button type="button" id="cancelFeedbackBtn" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer;">
                <i class="fas fa-times me-2"></i>Batal
            </button>
            <button type="button" id="submitFeedbackBtn" style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">
                <i class="fas fa-check me-2"></i>Hantar Maklum Balas
            </button>
        </div>
    </div>
</div>

<script type="text/javascript">
    (function() {
        // Ensure jQuery is loaded before proceeding
        if (typeof $ === 'undefined') {
            console.error('jQuery is not loaded!');
            alert('jQuery failed to load. Please refresh the page.');
            return;
        }
        
        $(document).ready(function() {
        console.log('Booking page loaded successfully');
        console.log('jQuery version:', $.fn.jquery);
        
        // Theme Switcher Functionality
        $('.theme-option').click(function() {
            $('.theme-option').removeClass('active');
            $(this).addClass('active');
            var themeClass = $(this).data('theme');
            $('body').removeClass('theme-bg-1 theme-bg-2 theme-bg-3 theme-bg-4');
            $('body').addClass(themeClass);
            localStorage.setItem('barbershop-theme', themeClass);
        });

        // Load saved theme
        var savedTheme = localStorage.getItem('barbershop-theme');
        if (savedTheme) {
            $('body').addClass(savedTheme);
            $('.theme-option').removeClass('active');
            $('.theme-option[data-theme="' + savedTheme + '"]').addClass('active');
        }

        // Set minimum date to today
        var today = new Date().toISOString().split('T')[0];
        $('#appointmentDate').attr('min', today);

        // Submit booking
        $('#submitBookingBtn').click(function(e) {
            e.preventDefault();
            console.log('Submit booking button clicked');
            if (validateBookingForm()) {
                submitBooking();
            }
        });

        // Form validation
        function validateBookingForm() {
            console.log('Validating booking form...');
            var isValid = true;
            var requiredFields = ['customerName', 'customerPhone', 'serviceType', 'appointmentDate', 'appointmentTime'];
            
            requiredFields.forEach(function(fieldId) {
                var field = $('#' + fieldId);
                if (!field.val().trim()) {
                    console.log('Field is invalid:', fieldId);
                    field.addClass('is-invalid');
                    isValid = false;
                } else {
                    field.removeClass('is-invalid');
                }
            });

            if (!isValid) {
                console.log('Form validation failed');
                alertify.error('Please fill in all required fields.');
            } else {
                console.log('Form validation passed');
            }

            return isValid;
        }

        // Submit booking function
        function submitBooking() {
            console.log('Submitting booking...');
            var bookingData = {
                CustomerName: $('#customerName').val(),
                CustomerPhone: $('#customerPhone').val(),
                ServiceType: $('#serviceType').val(),
                AppointmentDate: $('#appointmentDate').val(),
                AppointmentTime: $('#appointmentTime').val(),
                BarberName: $('#barberSelect').val() || 'Any Available',
                SpecialRequests: $('#specialRequests').val()
            };
            
            console.log('Booking data:', bookingData);

            // Show loading state
            $('#submitBookingBtn').prop('disabled', true).html('<i class="fas fa-spinner fa-spin me-2"></i>Memproses...');

            // Make AJAX call to controller
            $.ajax({
                url: '/Booking/Create',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(bookingData),
                success: function(response) {
                    console.log('Booking submitted successfully:', response);
                    if (response.success) {
                        alertify.success('Janji temu berjaya ditempah! Kami akan menghubungi anda untuk pengesahan.');
                        $('#bookingForm')[0].reset();
                        // Update the bookings list without page refresh
                        updateTodayBookings();
                    } else {
                        alertify.error(response.message || 'Ralat berlaku semasa menempah janji temu.');
                    }
                },
                error: function(xhr, status, error) {
                    console.error('Booking submission failed:', error);
                    alertify.error('Ralat berlaku semasa menghantar permintaan. Sila cuba lagi.');
                },
                complete: function() {
                    // Reset button state
                    $('#submitBookingBtn').prop('disabled', false).html('<i class="fas fa-check me-2"></i>Tempah Janji Temu');
                }
            });
        }

        // Remove validation classes on input
        $('input, select, textarea').on('input change', function() {
            $(this).removeClass('is-invalid');
        });

        // Load today's bookings on page load
        loadTodayBookings();
        
        // Load dynamic data
        loadEmployees();
        loadServices();
        
        // Initialize feedback modal functionality
        initializeFeedbackModal();
        });
    })(); // End of immediately invoked function

    // Function to load today's bookings
    function loadTodayBookings() {
        $.ajax({
            url: '/Booking/GetTodayBookings',
            type: 'GET',
            success: function(response) {
                if (response.success) {
                    updateBookingsList(response.bookings);
                }
            },
            error: function(xhr, status, error) {
                console.error('Error loading today\'s bookings:', error);
            }
        });
    }

    // Function to update today's bookings (called after successful save)
    function updateTodayBookings() {
        loadTodayBookings();
    }

    // Function to update the bookings list display
    function updateBookingsList(bookings) {
        var bookingsContainer = $('#todayBookingsList');
        
        if (bookings.length === 0) {
            bookingsContainer.html('<div class="text-center text-muted py-4"><i class="fas fa-calendar-times fa-3x mb-3"></i><p>Tiada janji temu dijadualkan untuk hari ini</p></div>');
            return;
        }

        var html = '';
        bookings.forEach(function(booking) {
            var statusClass = booking.status === 'Disahkan' ? 'status-confirmed' : 
                             booking.status === 'Menunggu' ? 'status-pending' : 
                             booking.status === 'Finish' ? 'status-finished' : 'status-cancelled';
            
            // Convert status to Malay for display
            var statusText = booking.status === 'Disahkan' ? 'Disahkan' :
                            booking.status === 'Menunggu' ? 'Menunggu' :
                            booking.status === 'Finish' ? 'Selesai' :
                            booking.status === 'Cancel' ? 'Batal' : booking.status;
            
            html += '<div class="booking-item">';
            html += '<div class="booking-time">' + booking.appointmentTime + '</div>';
            html += '<div class="booking-details">';
            html += '<div class="booking-customer"><strong>' + booking.customerName + '</strong></div>';
            html += '<div class="booking-service">' + booking.serviceType + '</div>';
            html += '<div class="booking-barber"><i class="fas fa-user me-1"></i>' + (booking.barberName || 'Mana-mana Yang Tersedia') + '</div>';
            html += '</div>';
            html += '<div class="booking-status">';
            html += '<span class="status-badge ' + statusClass + '">' + statusText + '</span>';
            html += '<button class="btn btn-sm btn-outline-primary mt-2" onclick="openFeedbackModal(' + booking.id + ')" style="width: 100%; font-size: 12px;">';
            html += '<i class="fas fa-star me-1"></i>Beri Maklum Balas';
            html += '</button>';
            html += '</div>';
            html += '</div>';
        });

        bookingsContainer.html(html);
    }

    // Function to load employees for barber selection
    function loadEmployees() {
        $.ajax({
            url: '/EmployeeSetup/GetEmployees',
            type: 'GET',
            success: function(response) {
                if (response.success) {
                    updateBarberSelect(response.employees);
                }
            },
            error: function(xhr, status, error) {
                console.error('Error loading employees:', error);
            }
        });
    }

    // Function to update barber selection dropdown
    function updateBarberSelect(employees) {
        var barberSelect = $('#barberSelect');
        var activeEmployees = employees.filter(emp => emp.status === 'Aktif');
        
        // Clear existing options except the first one
        barberSelect.find('option:not(:first)').remove();
        
        activeEmployees.forEach(function(employee) {
            barberSelect.append('<option value="' + employee.name + '">' + employee.name + ' - ' + employee.role + '</option>');
        });
    }

    // Function to load services for service selection
    function loadServices() {
        $.ajax({
            url: '/Services/GetServices',
            type: 'GET',
            success: function(response) {
                if (response.success) {
                    updateServiceSelect(response.services);
                }
            },
            error: function(xhr, status, error) {
                console.error('Error loading services:', error);
            }
        });
    }

    // Function to update service selection dropdown
    function updateServiceSelect(services) {
        var serviceSelect = $('#serviceType');
        var activeServices = services.filter(service => service.isActive);
        
        // Clear existing options except the first one
        serviceSelect.find('option:not(:first)').remove();
        
        activeServices.forEach(function(service) {
            serviceSelect.append('<option value="' + service.name + '">' + service.name + ' - RM ' + parseFloat(service.price).toFixed(2) + '</option>');
        });
    }

    // Initialize feedback modal functionality
    function initializeFeedbackModal() {
        // Modal close functionality
        $('#closeFeedbackModalBtn, #cancelFeedbackBtn').click(function() {
            $('#feedbackModal').hide();
            resetFeedbackForm();
        });

        // Close modal when clicking outside
        $('#feedbackModal').click(function(e) {
            if (e.target === this) {
                $('#feedbackModal').hide();
                resetFeedbackForm();
            }
        });

        // Submit feedback
        $('#submitFeedbackBtn').click(function() {
            submitFeedback();
        });

        // Prevent modal content clicks from closing modal
        $('#feedbackModal > div').click(function(e) {
            e.stopPropagation();
        });
    }

    // Function to initialize star rating when modal opens
    function initializeStarRating() {
        // Remove existing event handlers to prevent duplicates
        $('.star-rating').off('click');
        $('.star-rating').off('mouseenter mouseleave');
        $('input[name="status"]').off('change');
        
        // Star rating functionality
        $('.star-rating').click(function() {
            var rating = $(this).data('rating');
            console.log('Star clicked:', rating);
            $('.star-rating').removeClass('active');
            // Highlight all stars up to the clicked rating
            for (var i = 1; i <= rating; i++) {
                $('.star-rating[data-rating="' + i + '"]').addClass('active');
            }
            console.log('Active stars after click:', $('.star-rating.active').length);
            $('input[name="rating"][value="' + rating + '"]').prop('checked', true);
            updateRatingText(rating);
        });

        // Hover effects for stars
        $('.star-rating').hover(
            function() {
                var rating = $(this).data('rating');
                highlightStars(rating);
            },
            function() {
                var selectedRating = $('input[name="rating"]:checked').val();
                if (selectedRating) {
                    highlightStars(selectedRating);
                } else {
                    $('.star-rating').removeClass('active');
                }
            }
        );

        // Status selection styling
        $('input[name="status"]').change(function() {
            $('input[name="status"]').parent().css({
                'border-color': '#e9ecef',
                'background-color': 'white'
            });
            $(this).parent().css({
                'border-color': $(this).val() === 'Finish' ? '#28a745' : 
                               $(this).val() === 'Cancel' ? '#dc3545' : '#ffc107',
                'background-color': $(this).val() === 'Finish' ? '#f8fff9' : 
                                  $(this).val() === 'Cancel' ? '#fff8f8' : '#fffdf0'
            });
        });
    }

    // Function to highlight stars
    function highlightStars(rating) {
        $('.star-rating').removeClass('active');
        for (var i = 1; i <= rating; i++) {
            $('.star-rating[data-rating="' + i + '"]').addClass('active');
        }
        console.log('Highlighting stars up to rating:', rating);
    }

    // Function to update rating text
    function updateRatingText(rating) {
        var texts = {
            1: 'Sangat Tidak Memuaskan',
            2: 'Tidak Memuaskan',
            3: 'Biasa',
            4: 'Memuaskan',
            5: 'Sangat Memuaskan'
        };
        $('#ratingText').text(texts[rating]);
    }

    // Function to reset feedback form
    function resetFeedbackForm() {
        $('#feedbackForm')[0].reset();
        $('.star-rating').removeClass('active');
        $('#ratingText').text('');
        $('input[name="status"]').parent().css({
            'border-color': '#e9ecef',
            'background-color': 'white'
        });
    }

    // Function to open feedback modal
    function openFeedbackModal(bookingId) {
        $('#feedbackBookingId').val(bookingId);
        $('#feedbackModal').show();
        // Initialize star rating functionality when modal opens
        setTimeout(function() {
            initializeStarRating();
        }, 100);
    }

    // Function to submit feedback
    function submitFeedback() {
        var bookingId = $('#feedbackBookingId').val();
        var rating = $('input[name="rating"]:checked').val();
        var comment = $('#feedbackComment').val();
        var status = $('input[name="status"]:checked').val();

        // Validation
        if (!rating) {
            alertify.error('Sila pilih penilaian perkhidmatan.');
            return;
        }

        if (!status) {
            alertify.error('Sila pilih status janji temu.');
            return;
        }

        var feedbackData = {
            BookingId: parseInt(bookingId),
            Rating: parseInt(rating),
            Comment: comment,
            Status: status
        };

        // Show loading state
        $('#submitFeedbackBtn').prop('disabled', true).html('<i class="fas fa-spinner fa-spin me-2"></i>Menghantar...');

        // Submit feedback
        $.ajax({
            url: '/api/AppointmentFeedback/submit',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(feedbackData),
            success: function(response) {
                if (response.success) {
                    alertify.success('Maklum balas berjaya dihantar!');
                    $('#feedbackModal').hide();
                    resetFeedbackForm();
                    // Refresh the bookings list
                    loadTodayBookings();
                } else {
                    alertify.error(response.message || 'Ralat berlaku semasa menghantar maklum balas.');
                }
            },
            error: function(xhr, status, error) {
                console.error('Feedback submission failed:', error);
                alertify.error('Ralat berlaku semasa menghantar maklum balas. Sila cuba lagi.');
            },
            complete: function() {
                $('#submitFeedbackBtn').prop('disabled', false).html('<i class="fas fa-check me-2"></i>Hantar Maklum Balas');
            }
        });
    }
</script>

<style>
/* Star Rating Styles */
.star-rating {
    font-size: 30px;
    color: #ddd;
    cursor: pointer;
    transition: color 0.2s ease;
    user-select: none;
}

.star-rating:hover,
.star-rating.active {
    color: #ffc107;
}

/* Removed this rule as it was preventing proper star highlighting */

/* Feedback Modal Styles */
#feedbackModal input[type="radio"]:checked + span {
    font-weight: bold;
}

#feedbackModal label:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

/* Booking specific styles */
.bookings-list {
    max-height: 400px;
    overflow-y: auto;
}

.booking-item {
    display: flex;
    align-items: center;
    padding: 15px;
    margin-bottom: 10px;
    background: #f8f9fa;
    border-radius: 10px;
    border-left: 4px solid var(--barbershop-secondary);
    transition: all 0.3s ease;
}

.booking-item:hover {
    background: #e9ecef;
    transform: translateX(5px);
}

.booking-time {
    font-weight: 700;
    color: var(--barbershop-primary);
    font-size: 1.1rem;
    min-width: 60px;
    margin-right: 15px;
}

.booking-details {
    flex: 1;
}

.booking-customer {
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 2px;
}

.booking-service {
    color: #6c757d;
    font-size: 0.9rem;
    margin-bottom: 2px;
}

.booking-barber {
    color: #6c757d;
    font-size: 0.8rem;
}

.booking-status {
    margin-left: 10px;
}

.status-confirmed {
    background: linear-gradient(135deg, #27ae60, #2ecc71);
    color: white;
}

.status-finished {
    background: linear-gradient(135deg, #28a745, #20c997);
    color: white;
}

.status-pending {
    background: linear-gradient(135deg, #f39c12, #e67e22);
    color: white;
}

.card-header {
    background: linear-gradient(135deg, var(--barbershop-primary), var(--barbershop-dark));
    color: white;
    border: none;
    padding: 20px;
    border-radius: 15px 15px 0 0;
}

.card-header h5 {
    margin: 0;
    font-weight: 600;
}

.barbershop-card {
    background: white;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    margin-bottom: 20px;
}

.card-body {
    padding: 25px;
}
</style>
